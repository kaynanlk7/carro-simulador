<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador de Carro Avançado</title>
<style>
:root{
  --bg:#0b1020;--panel:#141a2e;--accent:#4ade80;--muted:#94a3b8;--text:#e2e8f0;
}
*{box-sizing:border-box;}
html,body{margin:0;height:100%;background:linear-gradient(180deg,#0b1020,#0b0f1a 40%);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
.app{display:grid;grid-template-rows:auto 1fr auto;min-height:100%;}
header{padding:10px;display:flex;justify-content:space-between;background:#0d1426;border-bottom:1px solid #1f2937;position:sticky;top:0;}
header h1{margin:0;font-size:16px;font-weight:700;}
header .indicators{display:flex;gap:10px;align-items:center;}
.chip{background:#111827;border:1px solid #1f2937;border-radius:999px;padding:6px 10px;font-size:12px;}
.wrap{display:grid;grid-template-columns:1.1fr .9fr;gap:12px;padding:10px;}
.world{background:#0a0f1c;border:1px solid #1f2937;border-radius:16px;position:relative;overflow:hidden;min-height:340px;}
canvas#track{width:100%;height:100%;display:block;}
.controls{display:grid;gap:12px;}
.panel{background:var(--panel);border:1px solid #1f2937;border-radius:16px;padding:12px;}
.panel h3{margin:0 0 8px 0;font-size:14px;color:#cbd5e1;}
.pedals{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
.pedal{display:flex;flex-direction:column;gap:8px;}
.pedal label{font-size:13px;color:#cbd5e1;}
.slider{appearance:none;width:100%;height:46px;border-radius:12px;background:#0b1224;border:1px solid #1f2937;outline:none;}
.slider::-webkit-slider-thumb{appearance:none;width:34px;height:46px;border-radius:10px;background:linear-gradient(180deg,#111827,#0b0f1a);border:1px solid #334155;box-shadow:inset 0 0 0 2px #0b0f1a;}
.bar{height:6px;background:#0b1224;border:1px solid #1f2937;border-radius:999px;position:relative;overflow:hidden;}
.fill{position:absolute;inset:0 50% 0 0;background:var(--accent);}
.wheel-wrap{display:grid;grid-template-columns:120px 1fr;gap:12px;align-items:center;}
.wheel{width:160px;height:160px;margin:auto;border-radius:50%;background:radial-gradient(circle at 50% 50%,#0f172a 0 40%,#0b1224 41% 100%);border:1px solid #1f2937;position:relative;touch-action:none;}
.wheel::after{content:"";position:absolute;inset:18% 18%;border-radius:50%;border:1px dashed #334155;}
.wheel .spoke{position:absolute;left:50%;top:50%;width:6px;height:66px;background:#1f2937;transform-origin:center bottom;border-radius:6px;}
.gearbox{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
.gear{padding:12px;border-radius:12px;border:1px solid #334155;background:#0b1224;text-align:center;font-weight:700;cursor:pointer;user-select:none;}
.gear.active{outline:2px solid var(--accent);}
.readouts{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.gauge{background:#0b1224;border:1px solid #1f2937;border-radius:12px;padding:8px 10px;font-variant-numeric:tabular-nums;}
.gauge .lbl{font-size:11px;color:#94a3b8;}
.gauge .val{font-size:18px;font-weight:800;}
.help{font-size:12px;color:#94a3b8;line-height:1.5;}
.btnrow{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
button.minibtn{background:#0b1224;border:1px solid #334155;border-radius:10px;color:var(--text);padding:8px 10px;font-size:12px;cursor:pointer;}
button.minibtn:active{transform:translateY(1px);}
</style>
</head>
<body>
<div class="app">
<header>
<h1>Simulador de Carro Avançado</h1>
<div class="indicators">
<div class="chip" id="chip-gear">N</div>
<div class="chip" id="chip-rpm">RPM 900</div>
<div class="chip" id="chip-speed">0 km/h</div>
</div>
</header>
<div class="wrap">
<section class="world panel">
<canvas id="track" width="1200" height="700" aria-label="pista e carro"></canvas>
</section>
<section class="controls">
<div class="panel">
<h3>Volante</h3>
<div class="wheel-wrap">
<div class="wheel" id="wheel" aria-label="volante">
<div class="spoke" style="transform:translate(-50%,-100%) rotate(0deg)"></div>
</div>
<div class="help">
Arraste o volante (toque e gire) para direcionar o carro.
<div class="btnrow">
<button class="minibtn" id="btn-center">Centralizar</button>
<button class="minibtn" id="btn-reset">Resetar Carro</button>
</div>
</div>
</div>
</div>
<div class="panel">
<h3>Pedais</h3>
<div class="pedals">
<div class="pedal">
<label>Acelerador</label>
<input id="accel" class="slider" type="range" min="0" max="100" value="0"/>
<div class="bar"><div id="accelFill" class="fill" style="right:100%"></div></div>
</div>
<div class="pedal">
<label>Freio</label>
<input id="brake" class="slider" type="range" min="0" max="100" value="0"/>
<div class="bar"><div id="brakeFill" class="fill" style="right:100%"></div></div>
</div>
<div class="pedal">
<label>Embreagem</label>
<input id="clutch" class="slider" type="range" min="0" max="100" value="100"/>
<div class="bar"><div id="clutchFill" class="fill" style="right:0%"></div></div>
</div>
</div>
<div class="help">Para trocar de marcha, pise na embreagem (≥ 70%).</div>
</div>
<div class="panel">
<h3>Marchas</h3>
<div class="gearbox">
<div class="gear" data-g="R">R</div>
<div class="gear" data-g="N">N</div>
<div class="gear" data-g="1">1</div>
<div class="gear" data-g="2">2</div>
<div class="gear" data-g="3">3</div>
<div class="gear" data-g="4">4</div>
<div class="gear" data-g="5">5</div>
<div class="gear" data-g="6">6</div>
</div>
<div class="help">Troca bloqueada sem embreagem.</div>
</div>
<div class="panel">
<h3>Instrumentos</h3>
<div class="readouts">
<div class="gauge"><div class="lbl">Velocidade</div><div class="val" id="spd">0.0 km/h</div></div>
<div class="gauge"><div class="lbl">RPM</div><div class="val" id="rpm">900</div></div>
<div class="gauge"><div class="lbl">Marcha</div><div class="val" id="gear">N</div></div>
</div>
</div>
</section>
</div>
<script>
const canvas = document.getElementById("track");
const ctx = canvas.getContext("2d");

const maxRPMs = {R:3000,1:6000,2:6500,3:7000,4:7000,5:7000,6:7000,N:900};

let car = {
  x: canvas.width/2, y: canvas.height/2,
  angle: 0, speed:0, gear:"N", rpm:900
};

function updateGauges(){
  document.getElementById("spd").textContent = car.speed.toFixed(1)+" km/h";
  document.getElementById("rpm").textContent = Math.floor(car.rpm);
  document.getElementById("gear").textContent = car.gear;
}

function moveCar(){
  // Limite de canvas
  if(car.speed!==0){
    const rad = car.angle*Math.PI/180;
    car.x += Math.cos(rad) * car.speed * 0.1;
    car.y += Math.sin(rad) * car.speed * 0.1;
    if(car.x<20) car.x=20; if(car.x>canvas.width-20) car.x=canvas.width-20;
    if(car.y<20) car.y=20; if(car.y>canvas.height-20) car.y=canvas.height-20;
  }
}

function draw(){
  ctx.fillStyle="#0a0f1c";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.save();
  ctx.translate(car.x,car.y);
  ctx.rotate(car.angle*Math.PI/180);
  ctx.fillStyle="#4ade80";
  ctx.fillRect(-20,-10,40,20);
  ctx.restore();
}

function loop(){
  moveCar();
  draw();
  updateGauges();
  requestAnimationFrame(loop);
}

// Pedais
const accel = document.getElementById("accel");
const brake = document.getElementById("brake");
const clutch = document.getElementById("clutch");

function updateSpeedRPM(){
  let targetSpeed = accel.value*0.5 - brake.value*0.5;
  // Ajusta para marcha e RPM
  if(car.gear!=="N"){
    let maxRPM = maxRPMs[car.gear];
    car.rpm = 900 + targetSpeed*20;
    if(car.rpm>maxRPM) targetSpeed=car.speed; // limita aceleração
  } else car.rpm = 900;
  car.speed += (targetSpeed - car.speed)*0.1;
}

accel.addEventListener("input", updateSpeedRPM);
brake.addEventListener("input", updateSpeedRPM);

// Marchas
document.querySelectorAll(".gear").forEach(btn=>{
  btn.addEventListener("click",()=>{
    if(clutch.value>=70){
      car.gear = btn.dataset.g;
      car.rpm = 900 + car.speed*20;
    }
  });
});

// Volante
let wheel = document.getElementById("wheel");
let dragging=false;
let startAngle=0;
wheel.addEventListener("pointerdown",e=>{dragging=true; startAngle=e.clientX;});
window.addEventListener("pointerup",()=>dragging=false);
window.addEventListener("pointermove",e=>{
  if(dragging){
    let delta = e.clientX - startAngle;
    car.angle += delta*0.5;
    startAngle=e.clientX;
  }
});

// Botões
document.getElementById("btn-center").addEventListener("click",()=>{car.angle=0;});
document.getElementById("btn-reset").addEventListener("click",()=>{
  car.x=canvas.width/2; car.y=canvas.height/2; car.angle=0; car.speed=0;
});

setInterval(updateSpeedRPM,50);
loop();
</script>
</body>
</html>
